{% extends "base.html" %}

{% block content %}
<h2>{{ channel.user.username }}'s Channel</h2>
{% if channel.avatar %}
    <img src="{{ channel.avatar.url }}" alt="Avatar" width="150">
{% else %}
    <p>No avatar available</p>
{% endif %}
<p>{{ channel.description }}</p>
<p>Subscribers: {{ subscriber_count }}</p>

{% if user.is_authenticated %}
    {% if is_subscribed %}
        <form method="post" action="{% url 'unsubscribe' channel.id %}">
            {% csrf_token %}
            <button type="submit">Unfollow</button>
        </form>
    {% else %}
        <form method="post" action="{% url 'subscribe' channel.id %}">
            {% csrf_token %}
            <button type="submit">Follow</button>
        </form>
    {% endif %}
{% endif %}

<h3>Videos</h3>
<ul id="video-list">
    {% for video in videos %}
    <li id="video-{{ video.id }}">
        <a href="{% url 'video_detail' video.id %}">{{ video.title }}</a>
        <video width="320" height="240" controls>
            <source src="{{ video.file.url }}" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        {% if user == channel.user %}
        <button onclick="openEditModal('{{ video.id }}', '{{ video.title }}', '{{ video.description }}')">Edit</button>
        <form method="post" action="{% url 'delete_video' video.id %}" onsubmit="return confirm('Are you sure you want to delete this video?');">
            {% csrf_token %}
            <button type="submit">Delete</button>
        </form>
        {% endif %}
    </li>
    {% endfor %}
</ul>

<!-- Edit Video Modal -->
<div id="editModal" style="display:none;">
    <div>
        <h2>Edit Video</h2>
        <form id="editForm" method="post" action="{% url 'edit_video' %}">
            {% csrf_token %}
            <input type="hidden" id="editVideoId" name="video_id">
            <label for="title">Title:</label>
            <input type="text" id="editTitle" name="title" required>
            <label for="description">Description:</label>
            <textarea id="editDescription" name="description" required></textarea>
            <button type="submit">Save Changes</button>
            <button type="button" onclick="closeEditModal()">Cancel</button>
        </form>
    </div>
</div>

<script>
function openEditModal(id, title, description) {
    document.getElementById('editVideoId').value = id;
    document.getElementById('editTitle').value = title;
    document.getElementById('editDescription').value = description;
    document.getElementById('editModal').style.display = 'block';
}

function closeEditModal() {
    document.getElementById('editModal').style.display = 'none';
}
</script>
{% endblock %}
